---
layout: post
title:  "Exploiting microsoft photos"
description: In this writeup I will show exploitation of microsoft photos.
---

Hi, today I will show you the exploitation of a logical bug in Microsoft photos so let's start. 

I was writing my previous [blog](/2021/02/01/xss-to-account-takeover-payu.html) where I had to hide some of my information such as authentication token, phone number and email. I am going to use below image in this blog to show the bug

![image](../../../assets/images/exploiting-photos-1.png){: .imagePopup}

I opened the image and hidded my information in Microsoft photos which is installed by default in windows. After hidding image looks like this where no one can see the what was the real text.

![image](../../../assets/images/exploiting-photos-2.png){: .imagePopup}

But what I found that Microsoft photos was animating the brush from starting point when the text was not hidden and animation was very fast that's why we can't see the text clearly but why this was animating because the same image was in another directory but that image was not animating.

After some more research I found the only difference between both the images is in their names.

![image](../../../assets/images/exploiting-photos-3.gif){: .imagePopup}

1. Image that was not animating ->  `exploiting-photos-1.jpg`

2. Image that was animating -> `exploiting-photos-1_LI.jpg`

Now I knew why they were animating. I thought it was animating because the original and edited images are in same system so to check this I moved exploiting-photos-1.jpg to windows 10 virtual machine then I renamed it from exploiting-photos-1.jpg to exploiting-photos-1_LI.jpg and the image was again animating in virtual machine then I was sure that It was a locial bug which can be exploited by an attacker to get sensitive data which was hided using Microsoft photos.

But we can't see the text clearly because animation is was very fast. Then the only thought that came to my mind was taking screenshots continuously and then opening image might disclose the text clearly. I wrote python script for taking continuous screenshots.

```python
import os
import sys
import pyscreenshot 

# taking image path as argument
inputFile = sys.argv[1]

# adding _LI to image
inputFileTmp = inputFile.split('.')
newInputFile = inputFileTmp[0]+'_LI.'+inputFileTmp[1]
os.rename(inputFile, newInputFile)
  
# taking screenshot continuously and saving it to output folder
count = 0
while True:
	count +=1
	image = pyscreenshot.grab() 
	image.save(f"output/poc-{str(count)}.png") 
```

# Steps to reproduce

1. Run above python script.
```
> python3 poc.py hidden-image.jpg
```

2. Open image multiple times, minimum 5 to 6 times and exit the python script CTRL + C.
3. Go to output folder where screenshots were saved and find a image which discloses text. 

You can see the image below where we can see the hidden text clearly.

![image](../../../assets/images/exploiting-photos-4.png){: .imagePopup}


# Proof-of-Concept

![image](../../../assets/images/exploiting-photos-5.gif){: .imagePopup}

I Reported this to Microsoft and they told me that this is not a Microsoft product and closed the report as N/A But If You see the about of Photos app then it will show this.

![image](../../../assets/images/exploiting-photos-6.png){: .imagePopup}

That's it for this blog Thanks for reading.